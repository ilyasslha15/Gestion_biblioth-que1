<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modifier un livre</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
    background-color: #f8f9fa;
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    padding: 0;
}

#content {
    max-width: 450px; /* plus compact */
    margin: 60px auto; /* moins de marge verticale */
}

#bookForm {
    background: #fff;
    padding: 20px; /* réduit padding */
    border-radius: 1rem;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
}

h2#pageTitle {
    color: #0d6efd;
    text-align: center;
    margin-bottom: 20px;
    font-size: 1.5rem; /* un peu plus petit */
}

.btn-primary {
    background-color: #0d6efd;
    border-color: #0d6efd;
}
.btn-primary:hover {
    background-color: #0661d1;
    border-color: #0661d1;
}

.text-danger {
    font-size: 0.85rem;
}
.text-success {
    font-size: 0.9rem;
    text-align: center;
}
</style>
</head>

<body>

<div id="content">
    <h2 id="pageTitle">Modifier un livre</h2>

    <form id="bookForm">
        <div class="mb-2">
            <label for="title" class="form-label">Titre</label>
            <input type="text" id="title" class="form-control form-control-sm">
            <div class="text-danger" id="errTitle"></div>
        </div>

        <div class="mb-2">
            <label for="author" class="form-label">Auteur</label>
            <input type="text" id="author" class="form-control form-control-sm">
            <div class="text-danger" id="errAuthor"></div>
        </div>

        <div class="mb-2">
            <label for="year" class="form-label">Année</label>
            <input type="number" id="year" class="form-control form-control-sm">
            <div class="text-danger" id="errYear"></div>
        </div>

        <div class="mb-2">
            <label for="type" class="form-label">Type</label>
            <input type="text" id="type" class="form-control form-control-sm">
            <div class="text-danger" id="errtype"></div>
        </div>

        <div class="mb-2">
            <label for="prix" class="form-label">Prix</label>
            <input type="text" id="prix" class="form-control form-control-sm">
            <div class="text-danger" id="errprix"></div>
        </div>

        <button type="submit" class="btn btn-primary w-100 btn-sm" id="submitBtn">Modifier</button>
    </form>

    <p class="mt-2 text-success" id="confirmation"></p>
</div>

<script>
// ===============================
// Vérification utilisateur
// ===============================
let user = JSON.parse(localStorage.getItem("currentUser"));
if (!user) window.location.href = "../login/login.html";

// ===============================
// Récupération livre
// ===============================
const params = new URLSearchParams(window.location.search);
const titleParam = decodeURIComponent(params.get("title") || "");

let books = JSON.parse(localStorage.getItem("books") || "[]");
let livre = books.find(b => b.title.toLowerCase() === titleParam.toLowerCase());
if (!livre) {
    alert("Livre introuvable !");
    window.location.href = "../html/Liste_livres.html";
}

// Pré-remplir le formulaire
const form = document.getElementById("bookForm");
const titleInput = document.getElementById("title");
const authorInput = document.getElementById("author");
const yearInput = document.getElementById("year");
const typeInput = document.getElementById("type");
const prixInput = document.getElementById("prix");

const errTitle = document.getElementById("errTitle");
const errAuthor = document.getElementById("errAuthor");
const errYear = document.getElementById("errYear");
const errPrix = document.getElementById("errprix");
const confirmation = document.getElementById("confirmation");

let oldTitle = livre.title;

titleInput.value = livre.title;
authorInput.value = livre.author;
yearInput.value = livre.year;
typeInput.value = livre.type;
prixInput.value = livre.prix;

// ===============================
// Validation formulaire
// ===============================
function validateForm() {
    let valid = true;

    errTitle.textContent = "";
    errAuthor.textContent = "";
    errYear.textContent = "";
    errPrix.textContent = "";

    if (titleInput.value.trim() === "") { valid = false; errTitle.textContent = "Titre obligatoire"; }
    if (authorInput.value.trim() === "") { valid = false; errAuthor.textContent = "Auteur obligatoire"; }
    const y = Number(yearInput.value);
    if (yearInput.value.trim() === "" || isNaN(y) || y < 1900 || y > 2025) { valid = false; errYear.textContent = "Année invalide"; }
    const p = Number(prixInput.value);
    if (prixInput.value.trim() === "" || isNaN(p) || p <= 0) { valid = false; errPrix.textContent = "Prix invalide"; }

    return valid;
}

// ===============================
// Soumission formulaire
// ===============================
form.addEventListener("submit", function(e) {
    e.preventDefault();
    if (!validateForm()) return;

    books = books.map(b => b.title === oldTitle ? {
        title: titleInput.value.trim(),
        author: authorInput.value.trim(),
        year: Number(yearInput.value.trim()),
        type: typeInput.value.trim(),
        prix: Number(prixInput.value.trim())
    } : b);

    localStorage.setItem("books", JSON.stringify(books));
    confirmation.textContent = "Livre modifié avec succès ! ✔";

    setTimeout(() => {
        window.location.href = "../html/Liste_livres.html";
    }, 1500);
});
</script>

</body>
</html>
